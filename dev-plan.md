開発計画
開発体制・技術スタック

本プロジェクトは小規模のため、1～2名の開発担当者で進める想定です（要件定義および開発担当: ○○さん）。GitHub上でソースコード管理を行い、ドキュメントもリポジトリにMarkdown形式で管理します。

選定技術および理由:

言語: サーバサイドには汎用性と開発効率の高いPython 3系を採用します。理由は、スクレイピングに適したライブラリ（Requests, BeautifulSoup, Scrapy等）が充実していること、全文検索やDB操作にも豊富なライブラリがあること、そして開発者の習熟度が高いためです。

フレームワーク: WebアプリケーションフレームワークにはPythonのFlaskもしくはDjangoを使用します。Djangoを使う場合は管理サイトやORMが最初から整っておりデータ管理に有利ですが、今回は画面要件がシンプルな検索・表示中心であるため軽量なFlask＋拡張ライブラリでも実現可能です。現時点ではFlaskを想定し、必要に応じてFlask-SQLAlchemy（ORM）やJinja2（テンプレート）、Flask-RESTful（API用）等を利用します。Django案も捨てがたいので、初期プロトタイプの段階で開発効率を比較して最終決定します。

データベース: 開発段階では手軽なSQLiteを用い、運用環境ではPostgreSQLまたはMySQLに移行します。オープンソースで信頼性が高く、全文検索機能も持つPostgreSQLが第一候補です。PostGIS等を導入すれば地理検索もできますが、現状必要ないためシンプルに使います。テーブル設計は上述のスキーマに従い、必要なインデックス（機器名、都道府県、外部利用可否などのカラム）を設定します。

スクレイピング: RequestsライブラリでHTMLを取得し、BeautifulSoup4でパース・項目抽出する方針です。サイトによっては構造が複雑な場合、正規表現やLXMLを併用します。動的ページの場合、SeleniumやPlaywrightによるヘッドレスブラウザ動作でレンダリング後のDOMを取得する方法も取り入れます。クローラ部分のコードはソースサイトごとにモジュールを分け、共通部分（HTTPリトライやパーサ）を共通化します。

フロントエンド: 基本的にはサーバサイドレンダリングでHTMLを生成し配信します。スタイルにはBootstrap 5等のCSSフレームワークを利用して迅速にUIを構築します。必要最低限のJavaScriptを用いて、例えば検索条件UIの操作性向上（チェックボックスで自動サブミットや、地図埋め込み）に対応します。フルSPAは採用しませんが、一部コンテンツはFetch APIで非同期ロードするなどモダンなUXも取り入れます。Google Maps埋め込みは上記のiframe方式で対応し、Google Maps Platformの最新APIを使用します（開発時にAPIキー取得とドメイン制限設定を実施）。

その他ツール: 開発にはエディタ/IDE（VSCode等）を使用し、コミュニケーションはGitHub Issuesやプロジェクトボードでタスク管理します。単体テストにはPyTest、統合テストにはSeleniumを利用し、主要機能の自動テストを整備します。

スケジュールとマイルストーン

開発は約3ヶ月程度を想定し、以下のフェーズで進行します（適宜見直し可能）。

フェーズ0: 要件確定と調査 (～2026年1月第4週)

要件定義書の作成とレビュー（※本ドキュメント）。最新のAPI仕様や関連情報を確認し反映。

データソースの構造調査（HTML構造、必要項目の存在確認）。Google検索等で各サイトの更新状況も調査。

技術選定の最終決定（Flask vs Django, DB種別等）。

フェーズ1: データ収集基盤構築 (2026年2月第1～2週)

データベース設計: テーブルスキーマ作成・実装（SQLiteで試作→PostgreSQL移行準備）。

クローラ実装: まず主要1～2ソース（ARIM、公設試サイト等）についてスクレイピングコードを開発。想定項目が正しく取得できるか検証し、equipmentテーブルに保存。

データ統合: 重複判定ロジックの実装・テスト。試験的に複数ソースのデータを投入し、同一キーが一件に統合されるか確認。

ロギング: クローラのログ出力や例外処理を整備。

マイルストーン: 基本的なデータ収集処理が動作し、主要ソースから数件以上のデータ取得・DB格納が成功していること。スキーマ項目の妥当性検証。

フェーズ2: バックエンド・検索機能開発 (2026年2月第3～4週)

Webアプリ骨格: Flaskアプリケーションひな形作成。ルーティングとテンプレートの基本を実装（トップページ、検索結果ページ、詳細ページの雛形）。

検索ロジック: DBからの検索クエリ実装。SQLAlchemyを用い、キーワード検索（LIKEクエリまたは全文検索）、各種フィルタ条件をクエリに反映する処理を実装。

一覧ページ実装: 取得した検索結果データをテンプレートに渡し、前述の項目（機器名・機関・所在地等）が正しく表示されるようコーディング。ページネーションやソート切替も実装。

詳細ページ実装: 詳細表示用にDBから1件取得しテンプレート表示。Googleマップ埋め込みiframeの組み込み（APIキーの配置）を行い、address_rawに基づき地図が表示されることを確認。

スタイル調整: Bootstrap等を適用し、レスポンシブ対応・デザイン調整。アイコン表示（外部利用可否や料金）を実装。必要に応じて日本語表示の微調整やヘルプテキストの追加。

マイルストーン: エンドユーザがブラウザから検索～結果閲覧～詳細確認の一連の操作を実行できる状態になる。主要機能の結合テストを実施し、想定通り動作すること。

フェーズ3: データ充実とテスト (2026年3月第1～2週)

他ソース拡張: 残りのデータソースのクローラを順次実装し、データベースに統合。件数増加によるパフォーマンス確認。

テスト: 単体テスト/統合テストの充実。特にスクレイピング処理はサイト変更に弱いため、現状のHTMLに対するパース部のテストを固定データで行う。Web画面については主要ブラウザ（Chrome, Firefox, Safari）で表示確認し、モバイル画面もチェック。異常系テスト（存在しない検索条件で結果0件になるケース等）も実施。

不具合修正・チューニング: テストで見つかったバグの修正。検索クエリのチューニング（例えば部分一致の方法改善や、STOPワード除去など必要なら実施）。UI文言のわかりやすさ最終調整。

性能改善: データ件数が増えた状態で検索の速度測定。必要ならDBインデックス追加やクエリ最適化を行う。大幅高速化が必要と判断した場合、Elasticsearch連携検討（ただし初期リリースには入れない想定）。

フェーズ4: リリース準備・ドキュメント整備 (2026年3月第3週)

本番環境セットアップ: サーバ環境にアプリケーションをデプロイ。データベース構築および初期データ投入（全ソース一斉クロール実行）。

監視設定: 稼働確認、ログ監視設定。アラートメールの試験送信。

ドキュメント整備: ユーザ向けの簡易利用ガイド、管理者向けの運用マニュアルをMarkdownで作成し、リポジトリに追加。クローラ追加方法やデプロイ手順なども記載。

GitHubリポジトリ整理: 最新コードとドキュメント（本要件定義書含む）をコミットし、リリースタグを作成。READMEにプロジェクト概要を記載して一般公開の準備。

関係者レビュー・最終調整: 開発関係者および依頼者にデモ・レビューを行い、最終的なフィードバックを反映します。致命的不具合がなければ本番サービス公開へ進みます。

フェーズ5: リリース＆フォロー (2026年3月末)

サービスを正式公開（ドメイン取得・DNS設定済みで公開）。関係機関にもリリース通知。

公開後1ヶ月程度はベータ期間と位置付け、ユーザからの問い合わせ対応や不具合監視を強化します。必要に応じてパッチリリース。

将来計画として、ユーザ要望の機能改善やソース追加（例: 企業内の装置共有情報など）を継続的に実施していきます。

リスクと対策

データ取得先の変更リスク: データソース側のサイト構造変更やURL変更により、スクレイピングが動作しなくなる可能性があります（実際ARIMサイトはURL変更の実績あり）。対策として、サイト変更を定期的にチェックし、迅速にクローラの修正を行います。各クローラにエラーハンドリングを入れ、失敗時には通知する仕組みを導入します。また、可能であれば提供元にAPI提供を働きかけたり、データカタログ等で公開されていないか調査します。

重複マージの不完全さ: 名前の揺れなどで同一機器を統合し損ね、検索結果に重複が出る可能性があります。運用上、定期的に同名機器の一覧をチェックし、手動で統合キーの例外リストを作るなど対応します。将来的には類似文字列マッチングのアルゴリズム（例えばLevenshtein距離やJaccard係数による類似度計算）を導入し、自動で疑わしい重複候補を検出する機能を検討します。

Google API利用制限: 現状Embed APIは無料無制限ですが、Googleのポリシー変更で利用制限や料金が発生する可能性があります。万一そうなった場合、地図表示をGoogle Mapsの単なるリンクに切り替える、またはオープンソースの地図（OpenStreetMap + Leaflet等）に移行することも視野に入れます。現時点ではAPIキーで適切に制限を設定しつつ無料枠内利用とし、Googleの最新情報をウォッチします。

検索性能の将来的低下: データ件数が飛躍的に増えた場合、現行設計では性能が落ちる可能性があります。その際はインフラ強化（DBサーバのスケールアップ）やElasticsearch導入などで対応します。OSS全文検索エンジンは大容量データでも高速検索が可能であり、必要になれば速やかに組み込みます。

プロジェクト進行上のリスク: 少人数開発のため、スケジュール遅延や機能実装漏れのリスクがあります。対策として、Issue管理によるタスクの見える化と優先度付けを行い、クリティカルな機能から順に実装します。進捗は週次でレビューし、必要に応じ計画を修正します。ドキュメント類も都度更新し、認識齟齬を防ぎます。

ドキュメント管理

本要件定義書および以降の設計書・マニュアル類はMarkdown形式で作成し、GitHubリポジトリ（research-patron/kikidoko）内でバージョン管理します。今回、プロジェクト名表記は一部誤りがあったため**「kikidoko」に統一**されています（リポジトリ名も修正済み）。本書も含め、確定したドキュメントはリポジトリにコミット・プッシュし、関係者間で共有します。開発中も要件の変更や追加があればドキュメントを随時アップデートし、コードと整合を取ります。

以上がkikidokoプロジェクトの詳細要件定義および開発計画です。本ドキュメントを基に開発を進め、随時最新の情報やAPI仕様を確認しながら柔軟に対応していきます。今後、実装段階で判明した課題や新たな要望については、関係者と合意の上で本書に追記・改訂を行ってプロジェクトの指針をアップデートしていきます。研究者にとって有用なサービスとなるよう、上記計画に従い着実に開発を進めてまいります。

参考文献・情報源:

文部科学省ARIM「共用設備検索」プラットフォームに関する記述（全国の大学・研究機関の共用設備数と概要）

Google Maps Platform ドキュメント（Maps Embed API）（地図埋め込みの方法とAPI利用条件）

経済産業省 公設試験研究機関 保有機器検索システム（地域ブロックと都道府県の対応）

OSS全文検索エンジンに関する解説（Elasticsearch等の高速検索エンジンの特徴）
