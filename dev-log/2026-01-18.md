# Dev log 2026-01-18

## Progress
- Added crawler sources for Hokkaido Univ (GFC API), AIST (PDF list pages), and Kyushu Univ (equipment list HTML tables).
- Wired new sources into the crawler CLI with `--source` options: `hokudai`, `aist`, `kyushu`, and `all`.
- Added `pdfplumber` dependency to parse AIST equipment list PDFs.
- Updated crawler README with new run examples.
- Ran dry-run crawls for each source and fixed AIST equipment ID matching.
- Unescaped HTML entities during text normalization to clean Hokkaido locations.
- Fixed Hokkaido pagination duplication because the API returns all records in one response.
- Created Firestore database in `asia-northeast1` and ran production upsert.
- Enabled Firestore API and created composite indexes for `prefecture + category_general` and `external_use + prefecture`.
- Added Firestore data fetch to the frontend and replaced sample data with live records.
- Added Firestore read-only rules and Firebase config for deployment.
- Added client-side pagination (8 items per page) to the frontend results list.
- Added AIST contact-address fallback from the ORP HTML page and documented the PDF-avoidance policy.
- Switched AIST collection source to the TIA HTML equipment lists (f=1..4) and removed PDF parsing dependency.
- Upsert now matches by `equipment_id` before `dedupe_key` to avoid duplicates.
- Set the UI fee-band fallback to `料金要相談` when fee data is missing (external-use labels remain `要相談`).
- Ran `npm install` in `frontend` to finalize Firebase dependencies (engine warnings on Node v20.18.0).
- Added table-based scrapers for RIKEN, UTokyo, Tsukuba, and TMDU, and updated source ordering to reflect priority.
- Added a legacy-TLS adapter to reach UTokyo’s ICS endpoint (DH key too small on default OpenSSL settings).
- Fixed UTokyo table header mapping and UTF-8 decoding so equipment names are captured instead of numeric IDs.

## Notes
- Hokkaido list is fetched via `https://www.gfc.hokudai.ac.jp/system/gfc_apparatus_list/list` with paging.
- AIST list PDFs are discovered from the ORP page and parsed per-table.
- Kyushu list extracts equipment name, location, contact, and notes; detail links become `source_url`.
- `npm install firebase` previously failed due to DNS; retry succeeded, but Vite tooling warns that Node 20.19+ or 22.12+ is preferred.
- PDF-only and login-required source exclusions are now documented in requirements and README.

## Validation
- Dry-run outputs created for `hokudai`, `aist`, and `kyushu` (limit=5) and spot-checked for key fields.
- Full dry-run outputs created (hokudai=1475, aist=362, kyushu=500).
- Production upsert results: created=1935, updated=402 (total 2337).
- Firestore doc counts by org: 北海道大学=1115, 九州大学=498, 産業技術総合研究所=322.
- AIST refresh after address fallback: updated=362.
- AIST refresh after TIA HTML switch: updated=91, created=1.
- RIKEN dry-run: 26 records (user-run).
- UTokyo dry-run: 494 records.
- Tsukuba dry-run: 1327 records.
- TMDU dry-run: 67 records.
- UTokyo upsert after name fix: updated=338, created=0.

## Next steps
- Implement Firestore query optimization/pagination to reduce full reads.
- Add detail page (`/equipment/:id`) and map link rendering.
